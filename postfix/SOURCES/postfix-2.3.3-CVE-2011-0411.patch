diff -up postfix-2.3.3/src/smtpd/smtpd.c.orig postfix-2.3.3/src/smtpd/smtpd.c
--- postfix-2.3.3/src/smtpd/smtpd.c.orig	2006-08-22 17:00:32.000000000 +0200
+++ postfix-2.3.3/src/smtpd/smtpd.c	2011-03-10 09:45:46.183105916 +0100
@@ -3663,6 +3663,9 @@ static int starttls_cmd(SMTPD_STATE *sta
     smtpd_chat_reply(state, "220 2.0.0 Ready to start TLS");
     /* Flush before we switch the stream's read/write routines. */
     smtp_flush(state->client);
+
+    /* At this point there must not be any pending plaintext. */
+    vstream_fpurge(state->client);
 
     /*
      * Reset all inputs to the initial state.
diff -up postfix-2.3.3/src/smtp/smtp_proto.c.orig postfix-2.3.3/src/smtp/smtp_proto.c
--- postfix-2.3.3/src/smtp/smtp_proto.c.orig	2006-07-25 23:10:57.000000000 +0200
+++ postfix-2.3.3/src/smtp/smtp_proto.c	2011-03-10 09:53:37.761670222 +0100
@@ -768,6 +768,9 @@ static int smtp_start_tls(SMTP_STATE *st
 			       "Cannot start TLS: handshake failure"));
     }
+
+    /* At this point there must not be any pending plaintext. */
+    vstream_fpurge(session->stream);
 
     /*
      * At this point we have to re-negotiate the "EHLO" to reget the
      * feature-list.
